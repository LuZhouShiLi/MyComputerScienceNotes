<html>
<head>
  <title>06libevent</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="3268"/>
<h1>06libevent</h1>

<div>
<span><div><div><font style="font-size: 14pt;">学习目标</font></div><ol style="margin-left: 0.375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-family: Cambria; font-weight: bold;"><li style="margin-top:0;margin-bottom:0;vertical-align:middle; margin-top:13pt;margin-bottom:13pt;font-weight:bold" value="1"><font style="font-size: 14pt;"><span style="font-family: 宋体; font-weight: bold;">描述什么是</span><span style="font-family: 宋体; font-weight: bold;">libevent</span><span style="font-family: 宋体; font-weight: bold;">并掌握如何安装</span></font></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:13pt; margin-bottom:13pt;font-weight:bold"><font style="font-size: 14pt;"><span style="font-weight: bold; font-family: 宋体;">掌握</span><span style="font-weight: bold; font-family: 宋体;">event_base</span><span style="font-weight: bold; font-family: 宋体;">的作用和使用方法</span></font></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:13pt; margin-bottom:13pt;font-weight:bold"><font style="font-size: 14pt;"><span style="font-weight: bold; font-family: 宋体;">熟练掌握</span><span style="font-weight: bold; font-family: 宋体;">libeve</span><span style="font-weight: bold; font-family: Calibri;">n</span><span style="font-weight: bold; font-family: 宋体;">t</span><span style="font-weight: bold; font-family: 宋体;">库中的事件循环</span></font></li></ol><ol style="margin-left: 0.375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-family: Cambria; font-weight: bold;"><li style="margin-top:0;margin-bottom:0;vertical-align:middle; margin-top:13pt;margin-bottom:13pt;font-weight:bold;color:#E84C22" value="4"><font style="font-size: 14pt;"><span style="font-family: 宋体; font-weight: bold;">掌握</span><span style="font-family: 宋体; font-weight: bold;">Event</span><span style="font-family: 宋体; font-weight: bold;">事件的使用方法</span></font></li></ol><ol style="margin-left: 0.375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-family: Cambria; font-weight: bold;"><li style="margin-top:0;margin-bottom:0;vertical-align:middle; margin-top:13pt;margin-bottom:13pt;font-weight:bold" value="5"><font style="font-size: 14pt;"><span style="font-family: 宋体; font-weight: bold;">掌握</span><span style="font-family: 宋体; font-weight: bold;">BufferEvent</span><span style="font-family: 宋体; font-weight: bold;">的工作方式</span></font></li></ol><ol style="margin-left: 0.375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-family: Cambria; font-weight: bold;"><li style="margin-top:0;margin-bottom:0;vertical-align:middle; margin-top:13pt;margin-bottom:13pt;font-weight:bold;color:#E84C22" value="6"><font style="font-size: 14pt;"><span style="font-family: 宋体; font-weight: bold;">掌握使用</span><span style="font-family: 宋体; font-weight: bold;">Libevent</span><span style="font-family: 宋体; font-weight: bold;">实现</span><span style="font-family: 宋体; font-weight: bold;">tcp</span><span style="font-family: 宋体; font-weight: bold;">服务器端流程</span></font></li></ol><ol style="margin-left: 0.375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-family: Cambria; font-weight: bold;"><li style="margin-top:0;margin-bottom:0;vertical-align:middle; margin-top:13pt;margin-bottom:13pt;font-weight:bold" value="7"><font style="font-size: 14pt;"><span style="font-family: 宋体; font-weight: bold;">掌握使用</span><span style="font-family: 宋体; font-weight: bold;">Libevent</span><span style="font-family: 宋体; font-weight: bold;">实现</span><span style="font-family: 宋体; font-weight: bold;">tcp</span><span style="font-family: 宋体; font-weight: bold;">客户端流程</span></font></li></ol><div><font style="font-size: 14pt;">1 libevent</font></div><div><font style="font-size: 14pt;">网络的事件库</font></div><div><font style="font-size: 14pt;">跨平台,支持多种多路io复用</font></div><div><font style="font-size: 14pt;">核心: 以事件驱动(触发),回调</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">2 安装libevent</font></div><div><font style="font-size: 14pt;">解压:</font></div><div><b><font style="color: rgb(241, 79, 154); font-size: 14pt;">tar -xzvf libevent-2.0.22-stable.tar.gz  -C ./install</font></b></div><div><font style="font-size: 14pt;">执行configure ,检测环境生成makefile</font></div><div><font style="color: rgb(241, 79, 154); font-size: 14pt;">./configure</font></div><div><font style="font-size: 14pt;">编译</font></div><div><font style="font-size: 14pt;">sudo make</font></div><div><font style="font-size: 14pt;">安装</font></div><div><font style="font-size: 14pt;">sudo make install</font></div><div><font style="font-size: 14pt;">库的路径: /usr/local/lib</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">头文件目录: /usr/local/include'</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">编译时需要指定库名  -levent</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">2 libevent的使用</font></div><div><font style="font-size: 14pt;">创建event_base根节点</font></div><div><font style="font-size: 14pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="font-weight: bold; font-family: Calibri, sans-serif; color: rgb(51, 51, 51);">struct event_base *event_base_new(void);</span></font></div></div><div><font style="font-size: 14pt;">返回值值就是event_base根节点地址</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">释放根节点</font></div><div><font style="font-size: 14pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-weight: bold; font-family: Monaco; color: rgb(51, 51, 51);-en-paragraph:true;"><font style="font-size: 14pt;">void event_base_free(struct event_base *);</font></span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">循环监听</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="text-indent: 21pt; font-weight: bold; font-family: 新宋体; color: blue; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">int</span> <span style="text-indent: 21pt; font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">event_base_dispatch(</span><span style="text-indent: 21pt; font-weight: bold; font-family: 新宋体; color: blue; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">struct</span> <span style="text-indent: 21pt; font-weight: bold; font-family: 新宋体; color: rgb(43, 145, 175); background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">event_base</span> <span style="text-indent: 21pt; font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">*base);</span></font></div></div><div><font style="font-size: 14pt;">相当于 while(1){epoll_wait}循环监听</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">退出循环监听</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 14pt;"><span style="font-weight: bold; font-family: 新宋体; color: blue; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">int</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">event_base_loopexit(</span><span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">struct</span> <span style="font-weight: bold; font-family: 新宋体; color: rgb(43, 145, 175); background: white;-en-paragraph:true;">event_base</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background: white;-en-paragraph:true;">*base,</span> <span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">const</span> <span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">struct</span> <span style="font-weight: bold; font-family: 新宋体; color: rgb(43, 145, 175); background: white;-en-paragraph:true;">timeval</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">*tv); //等待固定时间之后退出</span></font></div><div><font style="font-size: 14pt;"><span style="font-weight: bold; font-family: 新宋体; color: black;-en-paragraph:true;">   </span> <span style="font-weight: bold; font-family: 新宋体; color: blue; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">int</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">event_base_loopbreak(</span><span style="font-weight: bold; font-family: 新宋体; color: blue; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">struct</span> <span style="font-weight: bold; font-family: 新宋体; color: rgb(43, 145, 175); background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">event_base</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">*base);//立即退出</span></font></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">3 libevent时间触发流程</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><img src="06libevent_files/Image.png" type="image/png" data-filename="Image.png"/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">4 初始化上树节点</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><ol style="margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 57pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: ������; color: rgb(0, 0, 255);"><font style="font-size: 14pt;"><font><br/><span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">struct</span> <span style="min-height: 4pt; font-family: ������; color: rgb(43, 145, 175);-en-paragraph:true;">event</span> <span style="min-height: 4pt; font-family: ������;-en-paragraph:true;">*event_new(</span><span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">struct</span> <span style="min-height: 4pt; font-family: ������; color: rgb(43, 145, 175);-en-paragraph:true;">event_base</span> <span style="min-height: 4pt; font-family: ������;-en-paragraph:true;">*base, evutil_socket_t fd,</span> <span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">short events</span><span style="min-height: 4pt; font-family: ������;-en-paragraph:true;">,</span> <span style="min-height: 4pt; font-family: ������; color: rgb(43, 145, 175);-en-paragraph:true;">event_callback_fn cb</span><span style="min-height: 4pt; font-family: ������;-en-paragraph:true;">,</span> <span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">void</span> <span style="min-height: 4pt; font-family: ������;-en-paragraph:true;">*arg);</span></font><br/></font></li></ol></div><div><font style="font-size: 14pt;">参数:</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="min-height: 4pt; font-family: ������;"><font style="font-size: 14pt;">base: event_base根节点</font></span></div><div><span style="min-height: 4pt; font-family: ������;"><font style="font-size: 14pt;">fd: 上树的文件描述符</font></span></div><div><font style="font-size: 14pt;"><span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255);">events: 监听的事件</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="margin: 0cm 0cm 0.0001pt 27pt; text-indent: 19pt;"><font style="font-size: 14pt;"><span style="text-indent: 19pt; font-family: 新宋体; color: black;"><span>   </span>#define</span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;"> </span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">EV_TIMEOUT</span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;">        </span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">0x01</span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">  </span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;">//</span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">超时事件</span></font></div><div style="margin: 0cm 0cm 0.0001pt 48pt; text-indent: 19pt;"><font style="font-size: 14pt;"><span style="text-indent: 19pt; font-family: 新宋体; color: black;">#define</span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;"> </span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">EV_READ</span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;">                 </span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">0x02 //</span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">读事件</span></font></div><div style="margin: 0cm 0cm 0.0001pt 48pt; text-indent: 19pt;"><font style="font-size: 14pt;"><span style="text-indent: 19pt; font-family: 新宋体; color: black;">#define</span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;"> </span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">EV_WRITE</span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;">               </span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">0x04</span><span style="text-indent: 19pt; font-family: 新宋体; color: black;"> </span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;">//</span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">写事件</span></font></div><div style="margin: 0cm 0cm 0.0001pt 48pt; text-indent: 19pt;"><font style="font-size: 14pt;"><span style="text-indent: 19pt; font-family: 新宋体; color: black;">#define</span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;"> </span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">EV_SIGNAL</span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">            </span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;"> </span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">0x08</span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">    </span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;">//</span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">信号事件</span></font></div><div style="margin: 0cm 0cm 0.0001pt 48pt; text-indent: 19pt;"><font style="font-size: 14pt;"><span style="text-indent: 19pt; font-family: 新宋体; color: black;">#define</span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;"> </span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">EV_PERSIST</span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;">             </span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">0x10</span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">  </span> <span style="text-indent: 19pt; font-family: 新宋体; color: black;">//</span><span style="text-indent: 19pt; font-family: 新宋体; color: black;">周期性触发</span></font></div><div><font style="font-size: 14pt;"><span style="font-family: 新宋体; color: black;"><span>    </span><span>    </span>#define</span> <span style="font-family: 新宋体; color: black;"> </span><span style="font-family: 新宋体; color: black;">EV_ET</span> <span style="font-family: 新宋体; color: black;">     </span></font></div></div><div><span style="min-height: 4pt; font-family: ������; color: rgb(43, 145, 175);"><font style="font-size: 14pt;">cb: 回调函数</font></span></div><div><font style="font-size: 14pt;"><span style="font-family: 新宋体; color: blue; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">typedef</span> <span style="font-family: 新宋体; color: blue; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">void</span> <span style="font-family: 新宋体; color: black; background: white;-en-paragraph:true;">(*</span><span style="font-family: 新宋体; color: rgb(43, 145, 175); background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">event_callback_fn</span><span style="font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">)(evutil_socket_t fd,</span> <span style="font-family: 新宋体; color: blue; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">short events</span><span style="font-family: 新宋体; color: black; background: white;-en-paragraph:true;">,</span> <span style="font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">void</span> <span style="font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">*arg);</span></font></div><div><font style="font-size: 14pt;">arg: 传给回调函数的参数</font></div><div><font style="font-size: 14pt;">返回值: 初始化好的节点的地址</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">5 节点上树</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><ol style="margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 57pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: Calibri; color: rgb(0, 0, 255);"><font style="font-size: 14pt;"><br/></font><div style="min-height: 10pt; margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 14pt;"><span style="min-height: 10pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">int</span> <span style="min-height: 10pt; font-family: ������; color: rgb(51, 51, 51);-en-paragraph:true;">event_add(</span><span style="min-height: 10pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">struct</span> <span style="min-height: 10pt; font-family: ������; color: rgb(43, 145, 175);-en-paragraph:true;">event</span> <span style="min-height: 10pt; font-family: ������; color: rgb(51, 51, 51);-en-paragraph:true;">*ev,</span> <span style="min-height: 10pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">const</span> <span style="min-height: 10pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">struct</span> <span style="min-height: 10pt; font-family: ������; color: rgb(43, 145, 175);-en-paragraph:true;">timeval</span> <span style="min-height: 10pt; font-family: ������; color: rgb(51, 51, 51);-en-paragraph:true;">*timeout);</span></font></div></li></ol></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="min-height: 10pt; font-family: ������; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">ev: 上树节点的地址</font></span></div><div><font style="font-size: 14pt;"><span style="min-height: 10pt; font-family: ������; color: rgb(51, 51, 51);">timeout: NULL  永久监听  固定时间 限时等待</span></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">6 下树</font></div><ol style="margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 57pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: Calibri; color: rgb(0, 0, 255);"><font style="font-size: 14pt;"><br/></font><div style="min-height: 10pt; margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 14pt;"><span style="min-height: 10pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">int</span> <span style="min-height: 10pt; font-family: ������;-en-paragraph:true;">event_del(</span><span style="min-height: 10pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">struct</span> <span style="min-height: 10pt; font-family: ������; color: rgb(43, 145, 175);-en-paragraph:true;">event</span> <span style="min-height: 10pt; font-family: ������;-en-paragraph:true;">*ev);</span></font></div></li></ol><div><span style="min-height: 10pt; font-family: ������;"><font style="font-size: 14pt;">ev: 下树节点的地址</font></span></div><div><span style="min-height: 10pt; font-family: ������;"><font style="font-size: 14pt;"><br/></font></span></div><div><font style="font-family: ������; font-size: 14pt;">7 释放节点</font></div><ol style="margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 57pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: Calibri; color: rgb(0, 0, 255);"><font style="font-size: 14pt;"><br/></font><div style="min-height: 10pt; margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 14pt;"><span style="min-height: 10pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">void</span> <span style="min-height: 10pt; font-family: ������;-en-paragraph:true;">event_free(</span><span style="min-height: 10pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">struct</span> <span style="min-height: 10pt; font-family: ������; color: rgb(43, 145, 175);-en-paragraph:true;">event</span> <span style="min-height: 10pt; font-family: ������;-en-paragraph:true;">*ev);</span></font></div></li></ol><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">8 使用libevent编写tcp服务器流程</font></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 18.6667px;">创建套接字</span></div><div><span style="font-size: 18.6667px;">绑定</span></div><div><span style="font-size: 18.6667px;">监听</span></div><div><span style="font-size: 18.6667px;">创建event_base根节点</span></div><div><span style="font-size: 18.6667px;">初始化上树节点  lfd</span></div><div><span style="font-size: 18.6667px;">上树</span></div><div>循环监听</div><div>收尾</div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">8 bufferevent事件 </font></div><div><span style="font-size: 18.6667px;">普通的event事件   文件描述符   事件(底层缓冲区的读事件或者写事件) 触发    回调</span></div><div><span style="font-size: 18.6667px;">高级的event事件  bufferevent事件  </span></div><div><span style="font-size: 18.6667px;"><br/></span></div><div><span style="font-size: 18.6667px;">核心:  一个文件描述符  两个缓冲区  3个回调</span></div><div><img src="06libevent_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-size: 14pt;"/></div><div><span style="font-size: 18.6667px;"><br/></span></div><div><span style="font-size: 18.6667px;"><br/></span></div><div><font style="font-size: 14pt;">;9 bufferveent事件的监听流程</font></div><div><img src="06libevent_files/Image [2].png" type="image/png" data-filename="Image.png" style="font-size: 14pt;"/></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;">10 bufferevent事件的API</font></div><div><font style="font-size: 14pt;"> 创建新的节点</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><ol style="margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: ������; color: rgb(0, 0, 255);"><font style="font-size: 12pt;"><br/><span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">struct</span> <span style="min-height: 4pt; font-family: ������;-en-paragraph:true;">bufferevent *bufferevent_socket_new(</span><span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">struct</span> <span style="min-height: 4pt; font-family: ������;-en-paragraph:true;">event_base *base, evutil_socket_t fd,</span> <span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255);-en-paragraph:true;">int</span> <span style="min-height: 4pt; font-family: ������;-en-paragraph:true;">options);</span></font><br/></li></ol></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 18.6667px;">参数: </span></div><div><span style="font-size: 18.6667px;"><span>    <span style="font-size: 12pt; min-height: 4pt; font-family: ������;">base</span><span style="font-size: 14pt;">  : event_base 根节点</span></span><br/></span></div><div><span style="font-size: 12pt; min-height: 4pt; font-family: ������;"><span>    </span>fd: 要初始化上树的文件描述符</span></div><div><span style="font-size: 12pt; min-height: 4pt; font-family: ������;"><span>    <span style="font-size: 12pt; min-height: 4pt; font-family: ������;">options</span><span style="font-family: ������;"> : </span></span><br/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9.5pt; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;"><span>    </span><span>    </span><span>  </span> BEV_OPT_CLOSE_ON_FREE</span><span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; background: white; mso-highlight: white; mso-font-kerning: 0pt; mso-spacerun: yes;-en-paragraph:true;">  </span> <span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; background: white; mso-highlight: white; mso-font-kerning: 0pt;-en-paragraph:true;">--</span> <span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt;-en-paragraph:true;">释放</span><span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt;-en-paragraph:true;">bufferevent</span><span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt;-en-paragraph:true;">自动关闭底层接口</span><span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt; mso-spacerun: yes;-en-paragraph:true;">   </span></div><div><span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt; mso-tab-count: 2;-en-paragraph:true;">        </span> <span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt; background: white; mso-highlight: white;-en-paragraph:true;">BEV_OPT_THREADSAFE</span><span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt; mso-spacerun: yes;-en-paragraph:true;">     </span> <span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt;-en-paragraph:true;">--</span> <span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt;-en-paragraph:true;">使</span><span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt;-en-paragraph:true;">bufferevent</span><span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: black; mso-font-kerning: 0pt;-en-paragraph:true;">能够在多线程下是安全的<span>    </span></span></div><div><span style="font-size: 18.6667px;">返回值:</span></div><div><span style="font-size: 18.6667px;"><span>   新建节点的地址</span><br/></span></div><div><span style="font-size: 18.6667px;"><span><br/></span></span></div><div><span style="font-size: 18.6667px;">设置节点的回调</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="text-indent: 7mm; min-height: 12pt; font-family: 新宋体; font-size: 9pt; color: rgb(51, 51, 51);">释放bufferevent</span></div><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: ������; font-weight: bold; color: rgb(0, 0, 255);"><font style="font-size: 12pt;"><span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">void</span> <span style="font-family: ������; font-weight: bold;">bufferevent_setcb(</span><span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">struct</span> <span style="font-family: ������; font-weight: bold;">bufferevent *bufev,</span></font></li></ol><div style="min-height: 10pt;"><span style="min-height: 10pt; font-family: ������; font-weight: bold; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">    bufferevent_data_cb readcb, bufferevent_data_cb writecb,</font></span></div><div style="margin: 2.11mm 0mm; text-indent: 7mm; min-height: 10pt;"><font style="font-size: 12pt;"><span style="text-indent: 7mm; min-height: 10pt; font-family: ������; font-weight: bold; color: rgb(51, 51, 51);">bufferevent_event_cb eventcb,</span> <span style="text-indent: 7mm; min-height: 10pt; font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">void</span> <span style="text-indent: 7mm; min-height: 10pt; font-family: ������; font-weight: bold; color: rgb(51, 51, 51);">*cbarg);</span></font></div></div><div><span style="font-size: 18.6667px;"><br/></span></div><div><span style="font-size: 18.6667px;">参数:</span></div><div><span style="font-size: 18.6667px;"><span>    <span style="font-size: 12pt; font-family: ������; font-weight: bold;">bufev</span><span style="font-size: 14pt;"> : 新建的节点的地址</span></span><br/></span></div><div><span style="font-size: 18.6667px;"><span style="font-size: 14pt;"><span>    <span style="min-height: 10pt; font-family: ������; font-weight: bold; color: rgb(51, 51, 51); font-size: 12pt;">readcb</span><span style="font-size: 14pt;"> : 读回调</span></span><br/></span></span></div><div><span style="font-size: 18.6667px;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span>    <span style="min-height: 10pt; font-family: ������; font-weight: bold; color: rgb(51, 51, 51); font-size: 12pt;">writecb</span><span style="font-size: 14pt;"> : 写回调</span></span><br/></span></span></span></div><div><span style="font-size: 18.6667px;"><span>    </span><span style="font-size: 12pt; text-indent: 7mm; min-height: 10pt; font-family: ������; font-weight: bold; color: rgb(51, 51, 51);">eventcb</span><span style="font-size: 14pt;"> : 异常回调</span><br/></span></div><div><span style="font-size: 12pt; text-indent: 7mm; min-height: 10pt; font-family: ������; font-weight: bold; color: rgb(51, 51, 51);"><span>    </span>cbarg: 传给回调函数的参数</span></div><div><span style="font-size: 18.6667px;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><span style="font-family: 新宋体; color: black;-en-paragraph:true;">   </span> <span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">typedef</span> <span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">void</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background: white;-en-paragraph:true;">(*bufferevent_data_cb)(</span><span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">struct</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">bufferevent *bev,</span> <span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">void</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">*ctx);// 读写回调</span></font></div><div><font style="font-size: 12pt;"><span style="font-weight: bold; font-family: 新宋体; color: black;-en-paragraph:true;">   </span> <span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">typedef</span> <span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">void</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">(*bufferevent_event_cb)(</span><span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">struct</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">bufferevent *bev,</span> <span style="font-weight: bold; font-family: 新宋体; color: blue; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">short</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">what,</span> <span style="font-weight: bold; font-family: 新宋体; color: blue; background: white;-en-paragraph:true;">void</span> <span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;">*ctx);//事件回调</span></font></div><div><font style="font-size: 12pt;"><span style="font-weight: bold; font-family: 新宋体; color: black; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;-en-paragraph:true;"><br/></span></font></div><div><span style="font-size: 9.5pt; font-family: 新宋体; color: green; font-weight: bold;">BEV_EVENT_EOF, 对方关闭连接</span></div><div><span style="font-size: 9.5pt; font-family: 新宋体; color: green; font-weight: bold;">BEV_EVENT_ERROR</span><span style="font-size: 9.5pt; font-family: 新宋体; mso-hansi-font-family: Calibri; mso-bidi-font-family: 新宋体; color: green; mso-ansi-language: EN-US; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; font-weight: bold;">，出错</span></div><div><span style="font-size: 9.5pt; font-family: 新宋体; color: green; font-weight: bold;">BEV_EVENT_TIMEOUT,超时</span></div><div><span style="font-size: 9.5pt; font-family: 新宋体; color: green; font-weight: bold;"> BEV_EVENT_CONNECTED 建立连接成功</span></div></div><div><span style="font-size: 18.6667px;"><br/></span></div><div><span style="font-size: 18.6667px;">让事件使能</span></div><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: ������; font-weight: bold; color: rgb(0, 0, 255);"><font style="font-size: 12pt;"><span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">int</span> <span style="font-family: ������; font-weight: bold;">bufferevent_enable(</span><span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">struct</span> <span style="font-family: ������; font-weight: bold;">bufferevent *bufev,</span> <span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">short</span> <span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">event</span><span style="font-family: ������; font-weight: bold;">);//EV_READ  EV_WRITE</span></font></li><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: ������; color: rgb(0, 0, 255);"><font style="font-size: 12pt;"><span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">int</span> <span style="font-family: ������; font-weight: bold;">bufferevent_disable(</span><span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">struct</span> <span style="font-family: ������; font-weight: bold;">bufferevent *bufev,</span> <span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">short</span> <span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">event</span><span style="font-family: ������; font-weight: bold;">);//<span style="font-size: 12pt; font-family: ������; font-weight: bold; color: rgb(0, 0, 255);">EV_READ  EV_WRITE</span> </span></font></li></ol><div><span style="font-size: 18.6667px;"><br/></span></div><div><span style="font-size: 18.6667px;">发送数据</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: ������; font-weight: bold; color: rgb(0, 0, 255);"><font style="font-size: 14pt;"><span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">int</span> <span style="font-family: ������; font-weight: bold;">bufferevent_write(</span><span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">struct</span> <span style="font-family: ������; font-weight: bold;">bufferevent *bufev,</span> <span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">const</span> <span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">void</span> <span style="font-family: ������; font-weight: bold;">*data, size_t size);</span></font></li></ol><div style="min-height: 12pt;"><font style="font-size: 14pt;"><span style="min-height: 12pt; font-family: ������; color: rgb(51, 51, 51);">    </span><span style="min-height: 12pt; font-family: ������; color: rgb(191, 143, 0);">bufferevent_write是将data的数据写到bufferevent的写缓冲区</span></font></div></div><div><span style="font-size: 18.6667px;"><br/></span></div><div><span style="font-size: 18.6667px;">接收数据</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: ������; font-weight: bold; color: rgb(0, 0, 255);"><font style="font-size: 14pt;"><span style="font-family: ������; color: rgb(0, 0, 0); font-weight: bold;">size_t bufferevent_read(</span><span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">struct</span> <span style="font-family: ������; font-weight: bold;">bufferevent *bufev,</span> <span style="font-family: ������; color: rgb(0, 0, 255); font-weight: bold;">void</span> <span style="font-family: ������; font-weight: bold;">*data, size_t size);</span></font></li></ol><div style="min-height: 12pt;"><span style="min-height: 12pt; font-family: ������; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">    bufferevent_read 是将bufferevent的读缓冲区数据读到data中，同时将读到的数据从bufferevent的读缓冲清除。</font></span></div></div><div><span style="font-size: 18.6667px;"><br/></span></div><div><span style="font-size: 18.6667px;"><br/></span></div><div><span style="font-size: 18.6667px;">11 连接侦听器</span></div><div><span style="font-size: 18.6667px;">创建套接字 绑定 监听  提取</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: Calibri; color: rgb(1, 1, 1);"><font style="font-size: 14pt;"><br/><span style="min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1);">struct evconnlistener *evconnlistener_new_bind(struct event_base *base,</span><br/></font></li></ol><div style="margin-left: 6mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.00mm; margin-bottom: 0.00mm; min-height: 13pt;"><span style="text-indent: 0mm; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    evconnlistener_cb cb, void *ptr, unsigned flags, int backlog,</font></span></div><div style="margin-left: 6mm; margin-right: 0mm; text-indent: 7mm; margin-top: 0.00mm; margin-bottom: 0.00mm; min-height: 13pt;"><span style="text-indent: 7mm; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">const struct sockaddr *sa, int socklen);</font></span></div></div><div><span style="font-size: 18.6667px;">参数: </span></div><div><span style="font-size: 18.6667px;"><span>    <span style="font-size: 14pt; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1);">base</span><span style="font-size: 14pt;"> : base根节点</span></span><br/></span></div><div><span style="font-size: 18.6667px;"><span style="font-size: 14pt;"><span>    <span style="text-indent: 0mm; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1); font-size: 14pt;">cb</span><span style="font-size: 14pt;"> : 提取cfd后调用的回调</span></span><br/></span></span></div><div><span style="font-size: 18.6667px;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span>    <span style="text-indent: 0mm; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1); font-size: 14pt;">ptr</span><span style="font-size: 14pt;"> : 传给回调的参数</span></span><br/></span></span></span></div><div><span style="font-size: 18.6667px;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span>    <span style="text-indent: 0mm; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1); font-size: 14pt;">flags</span><span style="font-size: 14pt;"> : </span></span><br/></span></span></span></span></div><div><span style="font-size: 18.6667px;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span>    </span></span></span></span></span></span><br/></div><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;"><span>    </span><span>    </span>LEV_OPT_LEAVE_SOCKETS_BLOCKING</span><span style="mso-spacerun: yes; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">  </span> <span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">文件描述符为阻塞的</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="mso-tab-count: 1; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">      </span><font color="#F14F9A"><span style="font-family: Monaco; font-size: 9pt;-en-paragraph:true;">  </span> <span style="font-family: Monaco; font-size: 9pt;-en-paragraph:true;">LEV_OPT_CLOSE_ON_FREE</span><span style="font-family: Monaco; font-size: 9pt;-en-paragraph:true;">           </span> <span style="font-family: 宋体; font-size: 9pt;-en-paragraph:true;">关闭时自动释放</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font color="#F14F9A"><span style="font-family: Monaco; font-size: 9pt;-en-paragraph:true;">        </span> <span style="font-family: Monaco; font-size: 9pt;-en-paragraph:true;">LEV_OPT_REUSEABLE</span><span style="font-family: Monaco; font-size: 9pt;-en-paragraph:true;">               </span> <span style="font-family: 宋体; font-size: 9pt;-en-paragraph:true;">端口复用</span></font></div><div><span style="mso-tab-count: 1; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">        </span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">LEV_OPT_THREADSAFE</span><span style="mso-spacerun: yes; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">              </span> <span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">分配锁，线程安全</span></div></div><span style="text-indent: 0mm; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1); font-size: 14pt;">backlog</span> : -1<br/></div><div><span style="font-size: 18.6667px;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="text-indent: 7mm; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1); font-size: 14pt;">sa</span><span style="font-size: 14pt;"> : 绑定的地址信息</span></span></span></span></span></span></div><div><span style="font-size: 18.6667px;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="text-indent: 7mm; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1); font-size: 14pt;">socklen</span><span style="font-size: 14pt;"> : sa的大小</span><br/></span></span></span></span></span>返回值: 连接侦听器的地址</div><div><span style="font-size: 18.6667px;">回调</span></div><div><span style="font-size: 14pt;-en-paragraph:true;">typedef void (*evconnlistener_cb)(struct evconnlistener *evl, evutil_socket_t fd, struct sockaddr *cliaddr, int socklen, void *ptr);</span></div><div><span style="font-size: 18.6667px;">参数:</span></div><div><span style="font-size: 18.6667px;"><span>    <span style="font-size: 14pt;">evl</span><span style="font-size: 14pt;"> :  链接侦听器的地址</span></span><br/></span></div><div><span style="font-size: 18.6667px;"><span style="font-size: 14pt;"><span>    <span style="font-size: 14pt;">fd</span><span style="font-size: 14pt;"> :  cfd</span></span><br/></span></span></div><div><span style="font-size: 14pt;"><span>    </span>cliaddr: 客户端的地址信息</span></div><div><span style="font-size: 14pt;"><span>    </span>ptr:  <span style="font-size: 14pt; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1);">evconnlistener_new_bind传过来的参数</span></span></div><div><span style="font-size: 14pt;"><span style="font-size: 14pt; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-size: 14pt;"><span style="font-size: 14pt; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-size: 14pt;"><span style="font-size: 14pt; min-height: 13pt; font-family: Calibri; color: rgb(1, 1, 1);">12  创建套接字 连接服务器</span></span></div><div><span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255); font-size: 14pt;-en-paragraph:true;">struct</span> <span style="min-height: 4pt; font-family: ������; font-size: 14pt; color: rgb(1, 1, 1);-en-paragraph:true;">bufferevent *bufferevent_socket_new(</span><span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255); font-size: 14pt;-en-paragraph:true;">struct</span> <span style="min-height: 4pt; font-family: ������; font-size: 14pt; color: rgb(1, 1, 1);-en-paragraph:true;">event_base *base,-1,</span><span style="font-family: Calibri; font-size: 14pt; color: rgb(1, 1, 1);"> </span><span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255); font-size: 14pt;-en-paragraph:true;">int</span> <span style="min-height: 4pt; font-family: ������; font-size: 14pt; color: rgb(1, 1, 1);-en-paragraph:true;">options);</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><ol style="margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-family: ������; font-weight: bold; color: rgb(0, 0, 255);"><br/><font style="font-size: 12pt;"><span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255); font-weight: bold;-en-paragraph:true;">int</span> <span style="min-height: 4pt; font-family: ������; font-weight: bold;-en-paragraph:true;">bufferevent_socket_connect(</span><span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255); font-weight: bold;-en-paragraph:true;">struct</span> <span style="min-height: 4pt; font-family: ������; color: rgb(43, 145, 175); font-weight: bold;-en-paragraph:true;">bufferevent</span> <span style="min-height: 4pt; font-family: ������; font-weight: bold;-en-paragraph:true;">*bev,</span> <span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255); font-weight: bold;-en-paragraph:true;">struct</span> <span style="min-height: 4pt; font-family: ������; color: rgb(43, 145, 175); font-weight: bold;-en-paragraph:true;">sockaddr</span> <span style="min-height: 4pt; font-family: ������; font-weight: bold;-en-paragraph:true;">*serv,</span> <span style="min-height: 4pt; font-family: ������; color: rgb(0, 0, 255); font-weight: bold;-en-paragraph:true;">int</span> <span style="min-height: 4pt; font-family: ������; font-weight: bold;-en-paragraph:true;">socklen);</span></font><br/></li></ol><div style="font-size: 14pt;"></div></div><div><span style="font-size: 12pt; min-height: 4pt; font-family: ������; font-weight: bold;">bev: 新建的节点</span></div><div><span style="font-size: 12pt; min-height: 4pt; font-family: ������; font-weight: bold;">serv: 服务器的地址信息</span></div><div><span style="font-size: 12pt; min-height: 4pt; font-family: ������; font-weight: bold;"><br/></span></div><div><span style="font-size: 12pt; min-height: 4pt; font-family: ������; font-weight: bold;">socklen: <span style="font-size: 12pt; min-height: 4pt; font-family: ������; font-weight: bold;">serv长度</span></span></div><div><span style="font-size: 12pt; min-height: 4pt; font-family: ������; font-weight: bold;"><span style="font-size: 12pt; min-height: 4pt; font-family: ������; font-weight: bold;"><br/></span></span></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><br/></div></div></span>
</div></body></html> 