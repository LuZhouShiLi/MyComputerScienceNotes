<html>
<head>
  <title>05 反应堆线程池</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="3258"/>
<h1>05 反应堆线程池</h1>

<div>
<span><div><div><span style="font-size: 21.3333px;"><span style="font-family: 宋体; font-size: 21.3333px; font-weight: bold;">    学习目标</span></span></div><ol style="margin-left: 0.375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-size: 16pt;"><li style="vertical-align: middle; margin-top: 13pt; margin-bottom: 13pt;" value="1"><span style="font-size: 16pt; font-weight: bold; font-family: 宋体;">了解epoll反应堆设计思想</span></li><li style="vertical-align: middle; margin-top: 13pt; margin-bottom: 13pt;"><span style="font-size: 16pt; font-weight: bold; font-family: 宋体;">了解线程池思想以及能看懂线程池实现源码</span></li></ol><ol style="margin-left: 0.375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-size: 16pt;"><li style="vertical-align: middle; margin-top: 13pt; margin-bottom: 13pt;" value="3"><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">掌握</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">tcp</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">和</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">udp</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">的优缺点和使用场景</span></li></ol><ol style="margin-left: 0.375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-size: 16pt;"><li style="vertical-align: middle; margin-top: 13pt; margin-bottom: 13pt;" value="4"><span style="font-size: 16pt; font-family: 宋体; font-weight: bold;">说出</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold;">udp</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold;">服务器通信流程</span></li><li style="vertical-align: middle; margin-top: 13pt; margin-bottom: 13pt;"><span style="font-size: 16pt; font-family: 宋体; font-weight: bold;">说出</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold;">udp</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold;">客户端通信流程</span></li></ol><ol style="margin-left: 0.375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-size: 16pt;"><li style="vertical-align: middle; margin-top: 13pt; margin-bottom: 13pt;" value="6"><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">独立实现</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">udp</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">服务器代码</span></li><li style="vertical-align: middle; margin-top: 13pt; margin-bottom: 13pt;"><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">独立实现</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">udp</span><span style="font-size: 16pt; font-family: 宋体; font-weight: bold; color: rgb(232, 76, 34);">客户端代码</span></li></ol><ol style="margin-left: 0.375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in; font-size: 16pt;"><li style="vertical-align: middle; margin-top: 13pt; margin-bottom: 13pt;" value="8"><span style="font-size: 16pt; font-family: 宋体; font-weight: bold;">熟练掌握本地套接字进行本地进程通信</span></li></ol><div><br/></div><div>2 epoll反应堆</div><div>文件描述符   事件   回调函数  封装在一起</div><div>结构体来封装</div><div><br/></div><div><img src="05 反应堆线程池_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>反应堆复杂版代码</div><div><br/></div><div><img src="05 反应堆线程池_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>3  线程池</div><div>线程池,事先创建几个线程,,不停取任务,如果没有任务休眠,省去了不停的创建线程销毁销毁线程的事件和资源</div><div><br/></div><div>注意: 线程池 处理的任务,所需要处理的时间必须很短</div><div><br/></div><div>一个锁</div><div>两个条件变量</div><div>循环队列</div><div><br/></div><div><img src="05 反应堆线程池_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div>4 UDP和TCP</div><div>TCP: 传输控制协议   安全可靠  丢包重传   面向连接(电话模型) </div><div>UDP: 用户数据报协议  不安全不可靠 丢包不重传  快 不面向连接(邮件模型)</div><div><br/></div><div>tcp通信流程:</div><div><span> 服务器: 创建流式套接字 绑定 监听 提取 读写 关闭</span><br/></div><div>客户端: 创建流式套接字 连接 读写 关闭</div><div>收发数据:</div><div>read recv</div><div>ssize_t recv(int sockfd, void *buf, size_t len, int flags);//flags==MSG_PEEK 读数据不会删除缓冲区的数据</div><div>write  send</div><div>ssize_t send(int sockfd, const void *buf, size_t len, int flags);//flags=1 紧急数据</div><div><br/></div><div>udp通信流程</div><div>服务器: 创建报式套接字 绑定 读写 关闭</div><div>客户端:   创建报式套接字 读写  关闭</div><div>发数据:</div><div>ssize_t sendto(int sockfd, const void *buf, size_t len, int flags,</div><div>                      const struct sockaddr *dest_addr, socklen_t addrlen);</div><div><br/></div><div>dest_addr: 目的地的地址信息</div><div>addrlen: 结构体大小</div><div>收数据:</div><div>  ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags,</div><div>                        struct sockaddr *src_addr, socklen_t *addrlen);</div><div><br/></div><div>src_addr: 对方的地址信息</div><div>addrlen: 结构体大小的地址</div><div><br/></div><div><br/></div><div>5 创建报式套接字</div><div>socket</div><div>int socket(int domain, int type, int protocol);</div><div>参数:</div><div><span>    domain : AF_INET</span><br/></div><div><span><span>    type :SOCK_DGRAM</span><br/></span></div><div><span><span>    protocol :0</span><br/></span></div><div><span><br/></span></div><div><br/></div><div>6 本地套接字</div><div>unix domain   socket</div><div>本地套接字通信</div><div>全双工</div><div>套接字用文件来标识,这个文件在绑定之前是不能存在</div><div><br/></div><div><img src="05 反应堆线程池_files/Image [3].png" type="image/png" data-filename="Image.png"/>7 本地套接字实现tcp通信</div><div>创建本地套接字</div><div>绑定</div><div>监听</div><div>提取</div><div>读写</div><div>关闭</div><div><br/>
创建本地套接字用于tcp通信</div><div>int socket(int domain, int type, int protocol);</div><div>参数:</div><div><span>    domain : AF_UNIX</span><br/></div><div><span><span>    type :SOCK_STREAM</span><br/></span></div><div><span><span>    protocol : 0</span><br/></span></div><div><span><br/></span></div><div>绑定</div><div>int bind(int sockfd, const struct sockaddr *addr,</div><div>                socklen_t addrlen);</div><div><br/></div><div>sockfd: 本地套接字</div><div>addr:  本地套接字结构体地址</div><div>struct sockaddr_un {</div><div>               sa_family_t sun_family;               /* AF_UNIX */</div><div>               char        sun_path[108];            /* pathname *///文件的路径名</div><div>           };</div><div>addrlen: sockaddr_un大小 </div><div><br/></div><div><br/></div><div>提取</div><div>int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);</div><div><br/></div><div>addr: struct sockaddr_un 结构体地址</div><div><br/></div><div><br/></div><div>需要注意的点:</div><div>客户端可以隐式绑定,但是服务器不可以</div><div>绑定指定文件时m,这个文件必须不存在,如果存在绑定失败</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 